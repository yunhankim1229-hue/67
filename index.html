<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìˆ«ì ì½ì–´ì£¼ê¸° TTS ì•±</title>
    <!-- Tailwind CSS ë¡œë”© -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Tone.js ë¡œë”© (ìŒì•… ìƒì„±ìš©) -->
    <script src="https://unpkg.com/tone@14.9.11/build/Tone.js"></script> 
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Jua&display=swap');
        
        body {
            font-family: 'Jua', sans-serif;
            background-color: #f0f4f8; /* Light blue background */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .sound-container {
            max-width: 500px;
            width: 100%;
            background-color: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .action-button {
            width: 100%;
            padding: 15px 30px;
            margin-top: 20px;
            border-radius: 8px;
            font-size: 1.2rem;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.1s;
            background-color: #2563eb; /* Blue */
            box-shadow: 0 4px #1e40af;
        }
        
        .action-button:hover {
            background-color: #1e40af;
        }
        
        .action-button:active {
            transform: translateY(2px);
            box-shadow: 0 0 #1e40af !important;
        }
        
        .input-field {
            width: 100%;
            padding: 10px;
            font-size: 1.5rem;
            text-align: center;
            border: 2px solid #93c5fd;
            border-radius: 8px;
            outline: none;
            transition: border-color 0.2s;
        }
        
        .input-field:focus {
            border-color: #2563eb;
        }
        
        .error-message {
            color: #ef4444; /* Red */
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div class="sound-container">
        <h1 class="text-3xl font-bold mb-4 text-gray-800">ğŸ—£ï¸ ìˆ«ì ì½ì–´ì£¼ê¸° ì•± ğŸµ</h1>
        
        <p class="text-gray-600 mb-2">
            ìˆ«ìë¥¼ ì…ë ¥í•˜ê³  ë²„íŠ¼ì„ í´ë¦­í•˜ë©´, ê° ìë¦¿ìˆ˜ë¥¼ ì˜ì–´ë¡œ ì½ì–´ì¤ë‹ˆë‹¤.
        </p>
        <p class="text-xs text-pink-600 font-bold mb-4">
            * ğŸ¤« 67ì„ ì…ë ¥í•´ë³´ì„¸ìš”!
        </p>
        
        <!-- value="67"ì„ ì œê±°í•˜ì—¬ ì´ˆê¸°ê°’ ì—†ì´ ì‹œì‘í•˜ë„ë¡ ë³€ê²½ -->
        <input type="number" id="number-input" class="input-field" value="" placeholder="ì—¬ê¸°ì— ìˆ«ìë¥¼ ì…ë ¥í•˜ì„¸ìš”">
        
        <button id="read-btn" class="action-button" onclick="readNumber()">
            ğŸ“¢ ìˆ«ì ë°œìŒ ë“£ê¸°
        </button>
        
        <p id="reading-display" class="mt-4 text-xl text-gray-700 font-bold h-6"></p>

    </div>

    <script>
        // 1. ìˆ«ìë¥¼ ì˜ì–´ ë‹¨ì–´ë¡œ ë§¤í•‘ (TTSìš©)
        const digitMap = {
            '0': 'zero', '1': 'one', '2': 'two', '3': 'three', '4': 'four',
            '5': 'five', '6': 'six', '7': 'seven', '8': 'eight', '9': 'nine'
        };

        let currentDisplaySequence = []; // í˜„ì¬ í™”ë©´ì— í‘œì‹œë˜ëŠ” ë‹¨ì–´ ì‹œí€€ìŠ¤
        const synth = window.speechSynthesis; // TTS Synth

        let isPhonkPlaying = false; // íí¬ ì¬ìƒ ìƒíƒœ ì¶”ì 
        let rapScheduleId = null; // ë© ë©œë¡œë”” Part ì¶”ì ìš© (ì •ì§€ìš©)
        const bpm = 150; // Phonk í…œí¬

        // ==========================================================
        // Tone.js (Phonk Music) ì„¤ì •
        // ==========================================================

        // í‚¥ ë“œëŸ¼ (Membrane Synth)
        const kick = new Tone.MembraneSynth({
            volume: -2, 
            octaves: 4,
            pitchDecay: 0.05
        }).toDestination();

        // ë‹«íŒ í•˜ì´í–‡ (Closed Hihat - Noise Synth - íí¬ì˜ íŠ¹ì§•ì ì¸ ë¹ ë¥´ê³  ê±°ì¹œ ì†Œë¦¬)
        const hihat = new Tone.NoiseSynth({
            volume: -10,
            noise: { type: 'white' },
            envelope: { attack: 0.001, decay: 0.05, sustain: 0.005 }
        }).toDestination();

        // ì˜¤í”ˆ í•˜ì´í–‡ (Open Hihat - ê¸´ Releaseë¥¼ ê°€ì§„ í•˜ì´í–‡)
        const openHihat = new Tone.NoiseSynth({
            volume: -10,
            noise: { type: 'white' },
            envelope: { attack: 0.01, decay: 0.1, sustain: 0.3, release: 0.5 }
        }).toDestination();


        // ë² ì´ìŠ¤ (MonoSynth - ê¹Šì€ ì„œë¸Œ ë² ì´ìŠ¤)
        const bass = new Tone.MonoSynth({
            volume: -12,
            oscillator: { type: 'square' },
            envelope: { attack: 0.01, decay: 0.5, sustain: 0.2, release: 0.5 },
            filterEnvelope: { octaves: 4 }
        }).toDestination();
        
        // ìƒˆë¡œìš´ ê¸°íƒ€/ì‹ ìŠ¤ ë©œë¡œë”” (Phonk ë©œë¡œë””)
        const melodySynth = new Tone.MonoSynth({
            volume: -15, // ë°°ê²½ ë©œë¡œë””ì´ë¯€ë¡œ ë³¼ë¥¨ì„ ë‚®ì¶¥ë‹ˆë‹¤
            oscillator: { type: 'sawtooth' }, // í†±ë‹ˆíŒŒë¡œ ë‚ ì¹´ë¡œìš´ ì†Œë¦¬
            envelope: {
                attack: 0.01,
                decay: 0.2,
                sustain: 0.5,
                release: 0.8
            },
            filterEnvelope: {
                attack: 0.001,
                decay: 0.7,
                sustain: 0.1,
                release: 0.5,
                baseFrequency: 300, // ì–´ë‘ìš´ ëŠë‚Œì„ ìœ„í•´ ë‚®ì€ í•„í„° ì£¼íŒŒìˆ˜ ì„¤ì •
                octaves: 4, // í•„í„°ê°€ ì˜¬ë¼ê°€ëŠ” ì˜¥íƒ€ë¸Œ ìˆ˜
                exponent: 2
            }
        }).toDestination();
        
        // ìƒˆë¡œìš´ ë© ë³´ì»¬ ì‹ ìŠ¤ (Square waveë¡œ ë¡œë³´í‹±í•œ ë³´ì»¬ í…ìŠ¤ì²˜)
        const rapSynth = new Tone.Synth({
            volume: -8, 
            oscillator: { type: 'square' }, 
            envelope: { attack: 0.05, decay: 0.1, sustain: 0.5, release: 0.2 }
        }).toDestination();

        let melodyPart = null; // ë©œë¡œë”” íŒŒíŠ¸ ê°ì²´

        /**
         * íí¬ ë¹„íŠ¸ ì¬ìƒì„ ì¤‘ë‹¨í•©ë‹ˆë‹¤.
         */
        function stopPhonkBeat() {
            if (isPhonkPlaying) {
                // Tone.js íŠ¸ëœìŠ¤í¬íŠ¸ ì¤‘ì§€ ë° í´ë¦¬ì–´
                Tone.Transport.stop();
                Tone.Transport.cancel();
                
                // ë© ë©œë¡œë”” Part ì¤‘ì§€ ë° ì •ë¦¬
                if (rapScheduleId !== null) {
                    rapScheduleId.stop();
                    rapScheduleId.dispose();
                    rapScheduleId = null;
                }
                
                // ë©œë¡œë”” íŒŒíŠ¸ ì¤‘ì§€ ë° ì •ë¦¬
                if (melodyPart) {
                    melodyPart.stop();
                    melodyPart.dispose();
                    melodyPart = null;
                }

                // TTS ì¤‘ë‹¨ (ì¼ë°˜ ìˆ«ì ì½ê¸° ì¤‘ì¼ ê²½ìš° ëŒ€ë¹„)
                synth.cancel();

                isPhonkPlaying = false;
                document.getElementById('reading-display').textContent = "íí¬ ìŒì•… ì¤‘ë‹¨.";
                document.getElementById('read-btn').textContent = "ğŸ“¢ ìˆ«ì ë°œìŒ ë“£ê¸°";
            }
        }

        /**
         * íí¬ ë¹„íŠ¸ì™€ ë©ì„ ì¬ìƒí•©ë‹ˆë‹¤.
         */
        function playPhonkBeat() {
            stopPhonkBeat(); // í˜¹ì‹œ ì¬ìƒ ì¤‘ì¸ TTSë‚˜ Phonkì´ ìˆë‹¤ë©´ ì¤‘ë‹¨
            
            isPhonkPlaying = true;
            document.getElementById('read-btn').textContent = "â¹ï¸ í°í¬ ìŒì•… ë„ê¸°";
            document.getElementById('reading-display').textContent = "ğŸ¤ ì´ìŠ¤í„°ì—ê·¸ ë°œë™! ë©œë¡œë”” ë© (ë‹¨ì–´ í¬í•¨) ì¬ìƒ ì¤‘!";

            // ì˜¤ë””ì˜¤ ì»¨í…ìŠ¤íŠ¸ í™œì„±í™” ë° ë¹„íŠ¸ ì‹œì‘
            Tone.start().then(() => {
                Tone.Transport.bpm.value = bpm;
                
                // í‚¥ íŒ¨í„´ (4/4 ë°•ìì— ê°•í•œ í‚¥)
                new Tone.Loop(time => {
                    kick.triggerAttackRelease("C1", "8n", time); 
                }, "4n").start(0);

                // ë‹«íŒ í•˜ì´í–‡ íŒ¨í„´ (16ë¶„ ìŒí‘œì˜ ë¹ ë¥¸ ë¦¬ë“¬ - 8ë¶„ìŒí‘œì˜ ì—‡ë°•ì— ì¬ìƒ)
                new Tone.Loop(time => {
                    hihat.triggerAttackRelease("16n", time); 
                }, "8n").start("8n"); 
                
                // ì˜¤í”ˆ í•˜ì´í–‡ íŒ¨í„´ (4ë²ˆì§¸ ë°•ìì— ê°•ì¡°)
                new Tone.Loop(time => {
                    openHihat.triggerAttackRelease("8n", time + Tone.Transport.toSeconds("0:3")); 
                }, "1m").start(0); 

                // ë² ì´ìŠ¤ë¼ì¸ (ê°„ë‹¨í•œ ë² ì´ìŠ¤ ë¦¬ë“¬)
                const bassNotes = ["C2", "G1", "Eb2", "C2"];
                let bassIndex = 0;
                new Tone.Loop(time => {
                    bass.triggerAttackRelease(bassNotes[bassIndex % bassNotes.length], "4n", time);
                    bassIndex++;
                }, "4n").start(0);
                
                // ë©œë¡œë”” íŒŒíŠ¸ (2ë§ˆë”” ë£¨í”„ì˜ ê°„ë‹¨í•œ ë©œë¡œë””)
                melodyPart = new Tone.Part((time, note) => {
                    melodySynth.triggerAttackRelease(note.note, note.duration, time);
                }, [
                    // ë§ˆë”” 1 (C ë§ˆì´ë„ˆ ì½”ë“œ ëŠë‚Œ)
                    { time: "0:0:0", note: "C3", duration: "4n" }, 
                    { time: "0:2:0", note: "Eb3", duration: "4n" }, 
                    // ë§ˆë”” 2 (G ë§ˆì´ë„ˆ ì½”ë“œ ëŠë‚Œìœ¼ë¡œ ì „í™˜)
                    { time: "1:0:0", note: "G2", duration: "4n" }, 
                    { time: "1:2:0", note: "Bb2", duration: "4n" }, 
                ]);
                
                melodyPart.loop = true;
                melodyPart.loopEnd = "2m"; // 2ë§ˆë”” í›„ ë°˜ë³µ
                melodyPart.start(0); // íŠ¸ëœìŠ¤í¬íŠ¸ ì‹œì‘ê³¼ ë™ì‹œì— ì‹œì‘
                
                // ë© ë©œë¡œë”” & TTS ì‹œí€€ìŠ¤: "Six" (C4)ì™€ "Seven" (Eb4)ì— ë©œë¡œë””ì™€ ë‹¨ì–´ ë™ì‹œ ë¶€ì—¬
                const rapSequence = [
                    // Bar 1: "Six" on the 1st beat
                    { time: "0:0:0", note: "C4", duration: "4n", word: "six" }, 
                    
                    // Bar 2: "Seven" on the 3rd beat
                    { time: "1:2:0", note: "Eb4", duration: "8n", word: "seven" }, 
                ];

                rapScheduleId = new Tone.Part((time, noteData) => {
                    // 1. ì‹ ë””ì‚¬ì´ì €ë¡œ ë©œë¡œë”” ë…¸íŠ¸ ì¬ìƒ
                    rapSynth.triggerAttackRelease(noteData.note, noteData.duration, time);
                    
                    // 2. TTSë¡œ ë‹¨ì–´ ë°œìŒ
                    // ë© ìŒì„±ì„ ìœ„í•´ TTS ì†ë„ë¥¼ ì•½ê°„ ë¹ ë¥´ê²Œ ì„¤ì •
                    const utterance = new SpeechSynthesisUtterance(noteData.word);
                    utterance.lang = 'en-US';
                    utterance.rate = 1.2; // ë© ëŠë‚Œì„ ìœ„í•´ ì†ë„ ì¡°ì •
                    
                    // TTSëŠ” ë¹„ë™ê¸°ì´ë¯€ë¡œ Tone.jsì˜ ì •í™•í•œ ì‹œê°„ì— ë§ì¶° ì‹œì‘í•˜ëŠ” ë° í•œê³„ê°€ ìˆìŠµë‹ˆë‹¤.
                    synth.speak(utterance); 

                }, rapSequence);

                rapScheduleId.loop = true;
                rapScheduleId.loopEnd = "2m"; // 2ë§ˆë”” í›„ ë°˜ë³µ
                rapScheduleId.start(0); 

                Tone.Transport.start();

            }).catch(e => {
                document.getElementById('reading-display').textContent = "âš ï¸ ì˜¤ë””ì˜¤ ì‹œì‘ ì‹¤íŒ¨. (ë¸Œë¼ìš°ì € ì •ì±… í™•ì¸)";
                stopPhonkBeat();
            });
        }
        
        // ==========================================================
        // TTS (Text-to-Speech) ì„¤ì •
        // ==========================================================

        /**
         * í•œ ìë¦¿ìˆ˜ ìˆ«ìë¥¼ ë°œìŒí•˜ê³ , ë°œìŒì´ ëë‚˜ë©´ ì½œë°± í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
         */
        function readDigit(digit, callback) {
            const word = digitMap[digit];
            const displayElement = document.getElementById('reading-display');

            if (!word) {
                if (callback) callback();
                return;
            }

            const utterance = new SpeechSynthesisUtterance(word);
            utterance.lang = 'en-US'; 
            utterance.rate = 1.0; 
            utterance.pitch = 1.0; 
            
            // í™”ë©´ì— í˜„ì¬ ë°œìŒë˜ëŠ” ë‹¨ì–´ í‘œì‹œ
            currentDisplaySequence.push(word.toUpperCase());
            displayElement.textContent = currentDisplaySequence.join(' - ');

            // ë°œìŒì´ ëë‚˜ë©´ ë‹¤ìŒ ë‹¨ì–´ë¥¼ ì¬ìƒí•˜ë„ë¡ ì½œë°± ì„¤ì •
            utterance.onend = function() {
                if (callback) callback();
            };
            
            window.speechSynthesis.speak(utterance);
        }

        /**
         * íì— ìˆëŠ” ë‹¤ìŒ ë‹¨ì–´ë¥¼ ë°œìŒí•©ë‹ˆë‹¤.
         */
        function speakNext(queue) {
            const displayElement = document.getElementById('reading-display');
            
            if (queue.length === 0) {
                displayElement.textContent = "ì¬ìƒ ì™„ë£Œ!";
                return;
            }

            const nextDigit = queue.shift();
            
            // í˜„ì¬ ìˆ«ìë¥¼ ë°œìŒí•˜ê³ , ë°œìŒì´ ëë‚˜ë©´ ì¬ê·€ì ìœ¼ë¡œ speakNextë¥¼ í˜¸ì¶œí•˜ì—¬ ë‹¤ìŒ ìˆ«ìë¥¼ ì²˜ë¦¬
            readDigit(nextDigit, () => speakNext(queue));
        }


        /**
         * ìˆ«ì ì½ê¸° ë° ì¬ìƒ ë©”ì¸ í•¨ìˆ˜ (ì¡°ê±´ë¶€ ë¡œì§)
         */
        function readNumber() {
            const inputElement = document.getElementById('number-input');
            const displayElement = document.getElementById('reading-display');
            const numberString = String(inputElement.value).trim();
            
            // í°í¬ ì¬ìƒ ì¤‘ì´ë©´ ì¤‘ì§€í•˜ê³  ì¢…ë£Œ
            if (isPhonkPlaying) {
                stopPhonkBeat();
                return;
            }
            
            // TTS ì¤‘ë‹¨ (íí¬ ë¹„íŠ¸ê°€ ì•„ë‹Œ ì¼ë°˜ ë°œìŒ ì¬ìƒ ì¤‘ì¼ ê²½ìš°ë¥¼ ëŒ€ë¹„)
            synth.cancel();

            if (!numberString) {
                displayElement.textContent = "ìˆ«ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!";
                displayElement.classList.remove('error-message');
                return;
            }

            // ì¡°ê±´ 1: 67 ì…ë ¥ ì‹œ ì´ìŠ¤í„°ì—ê·¸(íí¬ ë¹„íŠ¸ + ë©œë¡œë”” ë©) ì¬ìƒ
            if (numberString === '67') {
                displayElement.classList.remove('error-message');
                playPhonkBeat();
                return;
            }
            
            // ì¡°ê±´ 2: 67 ì™¸ì˜ ìˆ«ì ì…ë ¥ ì‹œ TTS ì¬ìƒ (ê¸°ì¡´ ë¡œì§)
            
            if (!synth) {
                displayElement.classList.add('error-message');
                displayElement.textContent = "âš ï¸ ì£„ì†¡í•´ìš”, ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„± í•©ì„±ì„ ì§€ì›í•˜ì§€ ì•Šì•„ìš”.";
                return;
            }
            
            // ë””ìŠ¤í”Œë ˆì´ ì´ˆê¸°í™”
            currentDisplaySequence = [];
            displayElement.textContent = "";
            displayElement.classList.remove('error-message');

            const digitQueue = Array.from(numberString);
            
            speakNext(digitQueue);
        }

    </script>
</body>
</html>
